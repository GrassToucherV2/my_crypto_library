#include <string.h>

#include "cipher_test.h"
#include "test_util.h"
#include "../lib/aes.h"
#include "../lib/crypto_api.h"
#include "../lib/chacha20.h"
#include "../lib/poly1305.h"
#include "../lib/des.h"
#include "../lib/common.h"
#include "../util/tools.h"

// test vectors from https://www.ietf.org/rfc/rfc8439.txt
int chacha20_test(){
    int failed = 0;

    const unsigned char key[] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
    };

    const unsigned char nonce[] = {
        0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x4a, 
        0x00, 0x00, 0x00, 0x00
    };

    unsigned int counter = 1;

    const unsigned char plaintext[] = {
        0x4c, 0x61, 0x64, 0x69, 0x65, 0x73, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x47, 0x65, 0x6e, 0x74, 0x6c,
        0x65, 0x6d, 0x65, 0x6e, 0x20, 0x6f, 0x66, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6c, 0x61, 0x73,
        0x73, 0x20, 0x6f, 0x66, 0x20, 0x27, 0x39, 0x39, 0x3a, 0x20, 0x49, 0x66, 0x20, 0x49, 0x20, 0x63,
        0x6f, 0x75, 0x6c, 0x64, 0x20, 0x6f, 0x66, 0x66, 0x65, 0x72, 0x20, 0x79, 0x6f, 0x75, 0x20, 0x6f,
        0x6e, 0x6c, 0x79, 0x20, 0x6f, 0x6e, 0x65, 0x20, 0x74, 0x69, 0x70, 0x20, 0x66, 0x6f, 0x72, 0x20,
        0x74, 0x68, 0x65, 0x20, 0x66, 0x75, 0x74, 0x75, 0x72, 0x65, 0x2c, 0x20, 0x73, 0x75, 0x6e, 0x73,
        0x63, 0x72, 0x65, 0x65, 0x6e, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20, 0x62, 0x65, 0x20, 0x69,
        0x74, 0x2e
    };

    const unsigned char exp_cipher[] = {
        0x6e, 0x2e, 0x35, 0x9a, 0x25, 0x68, 0xf9, 0x80, 0x41, 0xba, 0x07, 0x28, 0xdd, 0x0d, 0x69, 0x81,
        0xe9, 0x7e, 0x7a, 0xec, 0x1d, 0x43, 0x60, 0xc2, 0x0a, 0x27, 0xaf, 0xcc, 0xfd, 0x9f, 0xae, 0x0b,
        0xf9, 0x1b, 0x65, 0xc5, 0x52, 0x47, 0x33, 0xab, 0x8f, 0x59, 0x3d, 0xab, 0xcd, 0x62, 0xb3, 0x57,
        0x16, 0x39, 0xd6, 0x24, 0xe6, 0x51, 0x52, 0xab, 0x8f, 0x53, 0x0c, 0x35, 0x9f, 0x08, 0x61, 0xd8,
        0x07, 0xca, 0x0d, 0xbf, 0x50, 0x0d, 0x6a, 0x61, 0x56, 0xa3, 0x8e, 0x08, 0x8a, 0x22, 0xb6, 0x5e,
        0x52, 0xbc, 0x51, 0x4d, 0x16, 0xcc, 0xf8, 0x06, 0x81, 0x8c, 0xe9, 0x1a, 0xb7, 0x79, 0x37, 0x36,
        0x5a, 0xf9, 0x0b, 0xbf, 0x74, 0xa3, 0x5b, 0xe6, 0xb4, 0x0b, 0x8e, 0xed, 0xf2, 0x78, 0x5e, 0x42,
        0x87, 0x4d
    };

    unsigned char ciphertext[114];
    unsigned char plain[114];
    crypt_chacha20_encrypt(plaintext, sizeof(plaintext), key, sizeof(key), nonce, sizeof(nonce), counter, ciphertext, sizeof(ciphertext));
    if(memcmp(exp_cipher, ciphertext, sizeof(exp_cipher))){
        print_failed("ChaCha20 encrypt test 1 failed");
        print_bytes_array(ciphertext, sizeof(ciphertext), "ciphertext");
        print_bytes_array(exp_cipher, sizeof(exp_cipher), "expected ciphertext");
    } else {
        print_passed("ChaCha20 encrypt test 1 passed");
        print_bytes_array(ciphertext, sizeof(ciphertext), "ciphertext");
    }
    crypt_chacha20_decrypt(exp_cipher, sizeof(exp_cipher), key, sizeof(key), nonce, sizeof(nonce), counter, plain, sizeof(plain));
    if(memcmp(plain, plaintext, sizeof(plain))){
        print_failed("ChaCha20 decrypt test 1 failed");
        print_bytes_array(plain, sizeof(plain), "plaintext");
        print_bytes_array(plaintext, sizeof(plaintext), "expected plaintext");
    } else {
        print_passed("ChaCha20 decrypt test 1 passed");
        print_bytes_array(plain, sizeof(plain), "plaintext");
    }

    const unsigned char key2[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    const unsigned char nonce2[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00
    };

    unsigned int counter2 = 0;

    const unsigned char plaintext2[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    const unsigned char exp_cipher2[] = {
        0x76, 0xb8, 0xe0, 0xad, 0xa0, 0xf1, 0x3d, 0x90, 
        0x40, 0x5d, 0x6a, 0xe5, 0x53, 0x86, 0xbd, 0x28, 
        0xbd, 0xd2, 0x19, 0xb8, 0xa0, 0x8d, 0xed, 0x1a, 
        0xa8, 0x36, 0xef, 0xcc, 0x8b, 0x77, 0x0d, 0xc7, 
        0xda, 0x41, 0x59, 0x7c, 0x51, 0x57, 0x48, 0x8d, 
        0x77, 0x24, 0xe0, 0x3f, 0xb8, 0xd8, 0x4a, 0x37, 
        0x6a, 0x43, 0xb8, 0xf4, 0x15, 0x18, 0xa1, 0x1c, 
        0xc3, 0x87, 0xb6, 0x69, 0xb2, 0xee, 0x65, 0x86
    };

    unsigned char ciphertext2[64];
    unsigned char plain2[64];
    crypt_chacha20_encrypt(plaintext2, sizeof(plaintext2), key2, sizeof(key2), nonce2, sizeof(nonce2), counter2, ciphertext2, sizeof(ciphertext2));
    if(memcmp(exp_cipher2, ciphertext2, sizeof(exp_cipher2))){
        print_failed("ChaCha20 encrypt test 2 failed");
        print_bytes_array(ciphertext2, sizeof(ciphertext2), "ciphertext");
        print_bytes_array(exp_cipher2, sizeof(exp_cipher2), "expected ciphertext");
    } else {
        print_passed("ChaCha20 encrypt test 2 passed");
        print_bytes_array(ciphertext2, sizeof(ciphertext2), "ciphertext");
    }
    crypt_chacha20_decrypt(exp_cipher2, sizeof(exp_cipher2), key2, sizeof(key2), nonce2, sizeof(nonce2), counter2, plain2, sizeof(plain2));
    if(memcmp(plain2, plaintext2, sizeof(plain2))){
        print_failed("ChaCha20 decrypt test 2 failed");
        print_bytes_array(plain2, sizeof(plain2), "plaintext");
        print_bytes_array(plaintext2, sizeof(plaintext2), "expected plaintext");
    } else {
        print_passed("ChaCha20 decrypt test 2 passed");
        print_bytes_array(plain2, sizeof(plain2), "plaintext");
    }

    const unsigned char key3[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01
    };

    const unsigned char nonce3[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x02
    };

    unsigned int counter3 = 1;

    const unsigned char plaintext3[] = {
        0x41, 0x6e, 0x79, 0x20, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x73, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x74,  
        0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x6e,  
        0x64, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x74, 0x68, 0x65, 0x20, 0x43, 0x6f, 0x6e, 0x74, 0x72,  
        0x69, 0x62, 0x75, 0x74, 0x6f, 0x72, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x70, 0x75, 0x62, 0x6c, 0x69,  
        0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x73, 0x20, 0x61, 0x6c, 0x6c, 0x20, 0x6f, 0x72,  
        0x20, 0x70, 0x61, 0x72, 0x74, 0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46,  
        0x20, 0x49, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65, 0x74, 0x2d, 0x44, 0x72, 0x61, 0x66, 0x74, 0x20, 
        0x6f, 0x72, 0x20, 0x52, 0x46, 0x43, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x61, 0x6e, 0x79, 0x20, 0x73,  
        0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x77, 0x69,  
        0x74, 0x68, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6f, 0x6e, 0x74, 0x65, 0x78, 0x74,  
        0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x61, 0x63, 0x74, 0x69,  
        0x76, 0x69, 0x74, 0x79, 0x20, 0x69, 0x73, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x69, 0x64, 0x65, 0x72,  
        0x65, 0x64, 0x20, 0x61, 0x6e, 0x20, 0x22, 0x49, 0x45, 0x54, 0x46, 0x20, 0x43, 0x6f, 0x6e, 0x74,  
        0x72, 0x69, 0x62, 0x75, 0x74, 0x69, 0x6f, 0x6e, 0x22, 0x2e, 0x20, 0x53, 0x75, 0x63, 0x68, 0x20, 
        0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x73, 0x20, 0x69, 0x6e, 0x63, 0x6c, 0x75,  
        0x64, 0x65, 0x20, 0x6f, 0x72, 0x61, 0x6c, 0x20, 0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e,  
        0x74, 0x73, 0x20, 0x69, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x73, 0x65, 0x73, 0x73, 0x69,  
        0x6f, 0x6e, 0x73, 0x2c, 0x20, 0x61, 0x73, 0x20, 0x77, 0x65, 0x6c, 0x6c, 0x20, 0x61, 0x73, 0x20, 
        0x77, 0x72, 0x69, 0x74, 0x74, 0x65, 0x6e, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x6c, 0x65, 0x63,  
        0x74, 0x72, 0x6f, 0x6e, 0x69, 0x63, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x75, 0x6e, 0x69, 0x63, 0x61,  
        0x74, 0x69, 0x6f, 0x6e, 0x73, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e,  
        0x79, 0x20, 0x74, 0x69, 0x6d, 0x65, 0x20, 0x6f, 0x72, 0x20, 0x70, 0x6c, 0x61, 0x63, 0x65, 0x2c,  
        0x20, 0x77, 0x68, 0x69, 0x63, 0x68, 0x20, 0x61, 0x72, 0x65, 0x20, 0x61, 0x64, 0x64, 0x72, 0x65,  
        0x73, 0x73, 0x65, 0x64, 0x20, 0x74, 0x6f
    };

    const unsigned char exp_cipher3[] = {
       0xa3, 0xfb, 0xf0, 0x7d, 0xf3, 0xfa, 0x2f, 0xde, 0x4f, 0x37, 0x6c, 0xa2, 0x3e, 0x82, 0x73, 0x70,
       0x41, 0x60, 0x5d, 0x9f, 0x4f, 0x4f, 0x57, 0xbd, 0x8c, 0xff, 0x2c, 0x1d, 0x4b, 0x79, 0x55, 0xec,
       0x2a, 0x97, 0x94, 0x8b, 0xd3, 0x72, 0x29, 0x15, 0xc8, 0xf3, 0xd3, 0x37, 0xf7, 0xd3, 0x70, 0x05,
       0x0e, 0x9e, 0x96, 0xd6, 0x47, 0xb7, 0xc3, 0x9f, 0x56, 0xe0, 0x31, 0xca, 0x5e, 0xb6, 0x25, 0x0d,
       0x40, 0x42, 0xe0, 0x27, 0x85, 0xec, 0xec, 0xfa, 0x4b, 0x4b, 0xb5, 0xe8, 0xea, 0xd0, 0x44, 0x0e,
       0x20, 0xb6, 0xe8, 0xdb, 0x09, 0xd8, 0x81, 0xa7, 0xc6, 0x13, 0x2f, 0x42, 0x0e, 0x52, 0x79, 0x50,
       0x42, 0xbd, 0xfa, 0x77, 0x73, 0xd8, 0xa9, 0x05, 0x14, 0x47, 0xb3, 0x29, 0x1c, 0xe1, 0x41, 0x1c,
       0x68, 0x04, 0x65, 0x55, 0x2a, 0xa6, 0xc4, 0x05, 0xb7, 0x76, 0x4d, 0x5e, 0x87, 0xbe, 0xa8, 0x5a,
       0xd0, 0x0f, 0x84, 0x49, 0xed, 0x8f, 0x72, 0xd0, 0xd6, 0x62, 0xab, 0x05, 0x26, 0x91, 0xca, 0x66,
       0x42, 0x4b, 0xc8, 0x6d, 0x2d, 0xf8, 0x0e, 0xa4, 0x1f, 0x43, 0xab, 0xf9, 0x37, 0xd3, 0x25, 0x9d,
       0xc4, 0xb2, 0xd0, 0xdf, 0xb4, 0x8a, 0x6c, 0x91, 0x39, 0xdd, 0xd7, 0xf7, 0x69, 0x66, 0xe9, 0x28,
       0xe6, 0x35, 0x55, 0x3b, 0xa7, 0x6c, 0x5c, 0x87, 0x9d, 0x7b, 0x35, 0xd4, 0x9e, 0xb2, 0xe6, 0x2b,
       0x08, 0x71, 0xcd, 0xac, 0x63, 0x89, 0x39, 0xe2, 0x5e, 0x8a, 0x1e, 0x0e, 0xf9, 0xd5, 0x28, 0x0f,
       0xa8, 0xca, 0x32, 0x8b, 0x35, 0x1c, 0x3c, 0x76, 0x59, 0x89, 0xcb, 0xcf, 0x3d, 0xaa, 0x8b, 0x6c,
       0xcc, 0x3a, 0xaf, 0x9f, 0x39, 0x79, 0xc9, 0x2b, 0x37, 0x20, 0xfc, 0x88, 0xdc, 0x95, 0xed, 0x84,
       0xa1, 0xbe, 0x05, 0x9c, 0x64, 0x99, 0xb9, 0xfd, 0xa2, 0x36, 0xe7, 0xe8, 0x18, 0xb0, 0x4b, 0x0b,
       0xc3, 0x9c, 0x1e, 0x87, 0x6b, 0x19, 0x3b, 0xfe, 0x55, 0x69, 0x75, 0x3f, 0x88, 0x12, 0x8c, 0xc0,
       0x8a, 0xaa, 0x9b, 0x63, 0xd1, 0xa1, 0x6f, 0x80, 0xef, 0x25, 0x54, 0xd7, 0x18, 0x9c, 0x41, 0x1f,
       0x58, 0x69, 0xca, 0x52, 0xc5, 0xb8, 0x3f, 0xa3, 0x6f, 0xf2, 0x16, 0xb9, 0xc1, 0xd3, 0x00, 0x62,
       0xbe, 0xbc, 0xfd, 0x2d, 0xc5, 0xbc, 0xe0, 0x91, 0x19, 0x34, 0xfd, 0xa7, 0x9a, 0x86, 0xf6, 0xe6,
       0x98, 0xce, 0xd7, 0x59, 0xc3, 0xff, 0x9b, 0x64, 0x77, 0x33, 0x8f, 0x3d, 0xa4, 0xf9, 0xcd, 0x85,
       0x14, 0xea, 0x99, 0x82, 0xcc, 0xaf, 0xb3, 0x41, 0xb2, 0x38, 0x4d, 0xd9, 0x02, 0xf3, 0xd1, 0xab,
       0x7a, 0xc6, 0x1d, 0xd2, 0x9c, 0x6f, 0x21, 0xba, 0x5b, 0x86, 0x2f, 0x37, 0x30, 0xe3, 0x7c, 0xfd,
       0xc4, 0xfd, 0x80, 0x6c, 0x22, 0xf2, 0x21                  
    };

    unsigned char ciphertext3[375];
    unsigned char plain3[375];
    crypt_chacha20_encrypt(plaintext3, sizeof(plaintext3), key3, sizeof(key3), nonce3, sizeof(nonce3), counter3, ciphertext3, sizeof(ciphertext3));
    if(memcmp(exp_cipher3, ciphertext3, sizeof(exp_cipher3))){
        print_failed("ChaCha20 encrypt test 3 failed");
        print_bytes_array(ciphertext3, sizeof(ciphertext3), "ciphertext");
        print_bytes_array(exp_cipher3, sizeof(exp_cipher3), "expected ciphertext");
    } else {
        print_passed("ChaCha20 encrypt test 3 passed");
        print_bytes_array(ciphertext3, sizeof(ciphertext3), "ciphertext");
    }
    crypt_chacha20_decrypt(exp_cipher3, sizeof(exp_cipher3), key3, sizeof(key3), nonce3, sizeof(nonce3), counter3, plain3, sizeof(plain3));
    if(memcmp(plain3, plaintext3, sizeof(plain3))){
        print_failed("ChaCha20 decrypt test 3 failed");
        print_bytes_array(plain3, sizeof(plain3), "plaintext");
        print_bytes_array(plaintext3, sizeof(plaintext3), "expected plaintext");
    } else {
        print_passed("ChaCha20 decrypt test 3 passed");
        print_bytes_array(plain3, sizeof(plain3), "plaintext");
    }

    const unsigned char key4[] = {
        0x1c, 0x92, 0x40, 0xa5, 0xeb, 0x55, 0xd3, 0x8a, 0xf3, 0x33, 0x88, 0x86, 0x04, 0xf6, 0xb5, 0xf0,
        0x47, 0x39, 0x17, 0xc1, 0x40, 0x2b, 0x80, 0x09, 0x9d, 0xca, 0x5c, 0xbc, 0x20, 0x70, 0x75, 0xc0
    };

    const unsigned char nonce4[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x02
    };

    unsigned int counter4 = 42;

    const unsigned char plaintext4[] = {
        0x27, 0x54, 0x77, 0x61, 0x73, 0x20, 0x62, 0x72, 0x69, 0x6c, 0x6c, 0x69, 0x67, 0x2c, 0x20, 0x61,
        0x6e, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x73, 0x6c, 0x69, 0x74, 0x68, 0x79, 0x20, 0x74, 0x6f,
        0x76, 0x65, 0x73, 0x0a, 0x44, 0x69, 0x64, 0x20, 0x67, 0x79, 0x72, 0x65, 0x20, 0x61, 0x6e, 0x64,
        0x20, 0x67, 0x69, 0x6d, 0x62, 0x6c, 0x65, 0x20, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x77,
        0x61, 0x62, 0x65, 0x3a, 0x0a, 0x41, 0x6c, 0x6c, 0x20, 0x6d, 0x69, 0x6d, 0x73, 0x79, 0x20, 0x77,
        0x65, 0x72, 0x65, 0x20, 0x74, 0x68, 0x65, 0x20, 0x62, 0x6f, 0x72, 0x6f, 0x67, 0x6f, 0x76, 0x65,
        0x73, 0x2c, 0x0a, 0x41, 0x6e, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x6d, 0x6f, 0x6d, 0x65, 0x20,
        0x72, 0x61, 0x74, 0x68, 0x73, 0x20, 0x6f, 0x75, 0x74, 0x67, 0x72, 0x61, 0x62, 0x65, 0x2e
    };

    const unsigned char exp_cipher4[] = {
        0x62, 0xe6, 0x34, 0x7f, 0x95, 0xed, 0x87, 0xa4, 0x5f, 0xfa, 0xe7, 0x42, 0x6f, 0x27, 0xa1, 0xdf,
        0x5f, 0xb6, 0x91, 0x10, 0x04, 0x4c, 0x0d, 0x73, 0x11, 0x8e, 0xff, 0xa9, 0x5b, 0x01, 0xe5, 0xcf,
        0x16, 0x6d, 0x3d, 0xf2, 0xd7, 0x21, 0xca, 0xf9, 0xb2, 0x1e, 0x5f, 0xb1, 0x4c, 0x61, 0x68, 0x71,
        0xfd, 0x84, 0xc5, 0x4f, 0x9d, 0x65, 0xb2, 0x83, 0x19, 0x6c, 0x7f, 0xe4, 0xf6, 0x05, 0x53, 0xeb,
        0xf3, 0x9c, 0x64, 0x02, 0xc4, 0x22, 0x34, 0xe3, 0x2a, 0x35, 0x6b, 0x3e, 0x76, 0x43, 0x12, 0xa6,
        0x1a, 0x55, 0x32, 0x05, 0x57, 0x16, 0xea, 0xd6, 0x96, 0x25, 0x68, 0xf8, 0x7d, 0x3f, 0x3f, 0x77,
        0x04, 0xc6, 0xa8, 0xd1, 0xbc, 0xd1, 0xbf, 0x4d, 0x50, 0xd6, 0x15, 0x4b, 0x6d, 0xa7, 0x31, 0xb1,
        0x87, 0xb5, 0x8d, 0xfd, 0x72, 0x8a, 0xfa, 0x36, 0x75, 0x7a, 0x79, 0x7a, 0xc1, 0x88, 0xd1                 
    };

    unsigned char ciphertext4[127];
    unsigned char plain4[127];
    crypt_chacha20_encrypt(plaintext4, sizeof(plaintext4), key4, sizeof(key4), nonce4, sizeof(nonce4), counter4, ciphertext4, sizeof(ciphertext4));
    if(memcmp(exp_cipher4, ciphertext4, sizeof(exp_cipher4))){
        print_failed("ChaCha20 encrypt test 4 failed");
        print_bytes_array(ciphertext4, sizeof(ciphertext4), "ciphertext");
        print_bytes_array(exp_cipher4, sizeof(exp_cipher4), "expected ciphertext");
    } else {
        print_passed("ChaCha20 encrypt test 4 passed");
        print_bytes_array(ciphertext4, sizeof(ciphertext4), "ciphertext");
    }
    crypt_chacha20_decrypt(exp_cipher4, sizeof(exp_cipher4), key4, sizeof(key4), nonce4, sizeof(nonce4), counter4, plain4, sizeof(plain4));
    if(memcmp(plain4, plaintext4, sizeof(plain4))){
        print_failed("ChaCha20 decrypt test 4 failed");
        print_bytes_array(plain4, sizeof(plain4), "plaintext");
        print_bytes_array(plaintext4, sizeof(plaintext4), "expected plaintext");
    } else {
        print_passed("ChaCha20 decrypt test 4 passed");
        print_bytes_array(plain4, sizeof(plain4), "plaintext");
    }

    const unsigned char key5[] = {
        0x1c, 0x92, 0x40, 0xa5, 0xeb, 0x55, 0xd3, 0x8a, 0xf3, 0x33, 0x88, 0x86, 0x04, 0xf6, 0xb5, 0xf0,
        0x47, 0x39, 0x17, 0xc1, 0x40, 0x2b, 0x80, 0x09, 0x9d, 0xca, 0x5c, 0xbc, 0x20, 0x70, 0x75, 0xc0
    };

    const unsigned char nonce5[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x02
    };

    unsigned int counter5 = 42;

    const unsigned char plaintext5[] = {
        "This is chacha20 encryption test - - - - - "
    };

    unsigned char ciphertext5[44];
    unsigned char plain5[44];
    crypt_chacha20_encrypt(plaintext5, sizeof(plaintext5), key5, sizeof(key5), nonce5, sizeof(nonce5), counter5, ciphertext5, sizeof(ciphertext5));
    print_bytes_array(ciphertext5, sizeof(ciphertext5), "ciphertext");
    crypt_chacha20_decrypt(ciphertext5, sizeof(ciphertext5), key5, sizeof(key5), nonce5, sizeof(nonce5), counter5, plain5, sizeof(plain5));
    print_bytes_array(plain5, sizeof(plain5), "plaintext");

    return failed;
}

int poly1305_test(){
    int failed = 0;
    unsigned char mac[16];
    poly1305_ctx ctx = {0};

    const unsigned char key1[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    const unsigned char plaintext1[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    const unsigned char exp_mac1[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };
    
    poly1305_init(&ctx, key1, sizeof(key1));
    poly1305_compute_mac(&ctx, plaintext1, sizeof(plaintext1), mac, 16);
    if(memcmp(mac, exp_mac1, sizeof(exp_mac1))){
        failed = 1;
        print_failed("Poly1305 test 1 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac1, sizeof(exp_mac1), "expected mac");
    } else {
        print_passed("Poly1305 test 1 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }

    const unsigned char key2[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x36, 0xe5, 0xf6, 0xb5, 0xc5, 0xe0, 0x60, 0x70,
        0xf0, 0xef, 0xca, 0x96, 0x22, 0x7a, 0x86, 0x3e
    };
    const unsigned char plaintext2[] = {
        0x41, 0x6e, 0x79, 0x20, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x73, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x74, 
        0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x6e, 
        0x64, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x74, 0x68, 0x65, 0x20, 0x43, 0x6f, 0x6e, 0x74, 0x72, 
        0x69, 0x62, 0x75, 0x74, 0x6f, 0x72, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x70, 0x75, 0x62, 0x6c, 0x69, 
        0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x73, 0x20, 0x61, 0x6c, 0x6c, 0x20, 0x6f, 0x72, 
        0x20, 0x70, 0x61, 0x72, 0x74, 0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 
        0x20, 0x49, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65, 0x74, 0x2d, 0x44, 0x72, 0x61, 0x66, 0x74, 0x20,
        0x6f, 0x72, 0x20, 0x52, 0x46, 0x43, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x61, 0x6e, 0x79, 0x20, 0x73, 
        0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x77, 0x69, 
        0x74, 0x68, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6f, 0x6e, 0x74, 0x65, 0x78, 0x74, 
        0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x61, 0x63, 0x74, 0x69, 
        0x76, 0x69, 0x74, 0x79, 0x20, 0x69, 0x73, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x69, 0x64, 0x65, 0x72, 
        0x65, 0x64, 0x20, 0x61, 0x6e, 0x20, 0x22, 0x49, 0x45, 0x54, 0x46, 0x20, 0x43, 0x6f, 0x6e, 0x74, 
        0x72, 0x69, 0x62, 0x75, 0x74, 0x69, 0x6f, 0x6e, 0x22, 0x2e, 0x20, 0x53, 0x75, 0x63, 0x68, 0x20,
        0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x73, 0x20, 0x69, 0x6e, 0x63, 0x6c, 0x75, 
        0x64, 0x65, 0x20, 0x6f, 0x72, 0x61, 0x6c, 0x20, 0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 
        0x74, 0x73, 0x20, 0x69, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x73, 0x65, 0x73, 0x73, 0x69, 
        0x6f, 0x6e, 0x73, 0x2c, 0x20, 0x61, 0x73, 0x20, 0x77, 0x65, 0x6c, 0x6c, 0x20, 0x61, 0x73, 0x20,
        0x77, 0x72, 0x69, 0x74, 0x74, 0x65, 0x6e, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x6c, 0x65, 0x63, 
        0x74, 0x72, 0x6f, 0x6e, 0x69, 0x63, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x75, 0x6e, 0x69, 0x63, 0x61, 
        0x74, 0x69, 0x6f, 0x6e, 0x73, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e, 
        0x79, 0x20, 0x74, 0x69, 0x6d, 0x65, 0x20, 0x6f, 0x72, 0x20, 0x70, 0x6c, 0x61, 0x63, 0x65, 0x2c, 
        0x20, 0x77, 0x68, 0x69, 0x63, 0x68, 0x20, 0x61, 0x72, 0x65, 0x20, 0x61, 0x64, 0x64, 0x72, 0x65, 
        0x73, 0x73, 0x65, 0x64, 0x20, 0x74, 0x6f
    };

    const unsigned char exp_mac2[] = {
        0x36, 0xe5, 0xf6, 0xb5, 0xc5, 0xe0, 0x60, 0x70, 0xf0, 0xef, 0xca, 0x96, 0x22, 0x7a, 0x86, 0x3e
    };
    
    poly1305_init(&ctx, key2, sizeof(key2));
    poly1305_compute_mac(&ctx, plaintext2, sizeof(plaintext2), mac, 16);
    if(memcmp(mac, exp_mac2, sizeof(exp_mac2))){
        failed = 1;
        print_failed("Poly1305 test 2 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac2, sizeof(exp_mac2), "expected mac");
    } else {
        print_passed("Poly1305 test 2 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }

    const unsigned char key3[] = {
        0x36, 0xe5, 0xf6, 0xb5, 0xc5, 0xe0, 0x60, 0x70,
        0xf0, 0xef, 0xca, 0x96, 0x22, 0x7a, 0x86, 0x3e,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    const unsigned char plaintext3[] = {
        0x41, 0x6e, 0x79, 0x20, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x73, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x74, 
        0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x6e, 
        0x64, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x74, 0x68, 0x65, 0x20, 0x43, 0x6f, 0x6e, 0x74, 0x72, 
        0x69, 0x62, 0x75, 0x74, 0x6f, 0x72, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x70, 0x75, 0x62, 0x6c, 0x69, 
        0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x73, 0x20, 0x61, 0x6c, 0x6c, 0x20, 0x6f, 0x72, 
        0x20, 0x70, 0x61, 0x72, 0x74, 0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 
        0x20, 0x49, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65, 0x74, 0x2d, 0x44, 0x72, 0x61, 0x66, 0x74, 0x20,
        0x6f, 0x72, 0x20, 0x52, 0x46, 0x43, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x61, 0x6e, 0x79, 0x20, 0x73, 
        0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x77, 0x69, 
        0x74, 0x68, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6f, 0x6e, 0x74, 0x65, 0x78, 0x74, 
        0x20, 0x6f, 0x66, 0x20, 0x61, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x61, 0x63, 0x74, 0x69, 
        0x76, 0x69, 0x74, 0x79, 0x20, 0x69, 0x73, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x69, 0x64, 0x65, 0x72, 
        0x65, 0x64, 0x20, 0x61, 0x6e, 0x20, 0x22, 0x49, 0x45, 0x54, 0x46, 0x20, 0x43, 0x6f, 0x6e, 0x74, 
        0x72, 0x69, 0x62, 0x75, 0x74, 0x69, 0x6f, 0x6e, 0x22, 0x2e, 0x20, 0x53, 0x75, 0x63, 0x68, 0x20,
        0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x73, 0x20, 0x69, 0x6e, 0x63, 0x6c, 0x75, 
        0x64, 0x65, 0x20, 0x6f, 0x72, 0x61, 0x6c, 0x20, 0x73, 0x74, 0x61, 0x74, 0x65, 0x6d, 0x65, 0x6e, 
        0x74, 0x73, 0x20, 0x69, 0x6e, 0x20, 0x49, 0x45, 0x54, 0x46, 0x20, 0x73, 0x65, 0x73, 0x73, 0x69, 
        0x6f, 0x6e, 0x73, 0x2c, 0x20, 0x61, 0x73, 0x20, 0x77, 0x65, 0x6c, 0x6c, 0x20, 0x61, 0x73, 0x20,
        0x77, 0x72, 0x69, 0x74, 0x74, 0x65, 0x6e, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x6c, 0x65, 0x63, 
        0x74, 0x72, 0x6f, 0x6e, 0x69, 0x63, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x75, 0x6e, 0x69, 0x63, 0x61, 
        0x74, 0x69, 0x6f, 0x6e, 0x73, 0x20, 0x6d, 0x61, 0x64, 0x65, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e, 
        0x79, 0x20, 0x74, 0x69, 0x6d, 0x65, 0x20, 0x6f, 0x72, 0x20, 0x70, 0x6c, 0x61, 0x63, 0x65, 0x2c, 
        0x20, 0x77, 0x68, 0x69, 0x63, 0x68, 0x20, 0x61, 0x72, 0x65, 0x20, 0x61, 0x64, 0x64, 0x72, 0x65, 
        0x73, 0x73, 0x65, 0x64, 0x20, 0x74, 0x6f
    };

    const unsigned char exp_mac3[] = {
        0xf3, 0x47, 0x7e, 0x7c, 0xd9, 0x54, 0x17, 0xaf,
        0x89, 0xa6, 0xb8, 0x79, 0x4c, 0x31, 0x0c, 0xf0
    };
    
    poly1305_init(&ctx, key3, sizeof(key3));
    poly1305_compute_mac(&ctx, plaintext3, sizeof(plaintext3), mac, 16);
    if(memcmp(mac, exp_mac3, sizeof(exp_mac3))){
        failed = 1;
        print_failed("Poly1305 test 3 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac3, sizeof(exp_mac3), "expected mac");
    } else {
        print_passed("Poly1305 test 3 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }

    const unsigned char key4[] = {
        0x1c, 0x92, 0x40, 0xa5, 0xeb, 0x55, 0xd3, 0x8a,
        0xf3, 0x33, 0x88, 0x86, 0x04, 0xf6, 0xb5, 0xf0,
        0x47, 0x39, 0x17, 0xc1, 0x40, 0x2b, 0x80, 0x09,
        0x9d, 0xca, 0x5c, 0xbc, 0x20, 0x70, 0x75, 0xc0
    };
    const unsigned char plaintext4[] = {
        0x27, 0x54, 0x77, 0x61, 0x73, 0x20, 0x62, 0x72, 0x69, 0x6c, 0x6c, 0x69, 0x67, 0x2c, 0x20, 0x61,
        0x6e, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x73, 0x6c, 0x69, 0x74, 0x68, 0x79, 0x20, 0x74, 0x6f,
        0x76, 0x65, 0x73, 0x0a, 0x44, 0x69, 0x64, 0x20, 0x67, 0x79, 0x72, 0x65, 0x20, 0x61, 0x6e, 0x64,
        0x20, 0x67, 0x69, 0x6d, 0x62, 0x6c, 0x65, 0x20, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x77,
        0x61, 0x62, 0x65, 0x3a, 0x0a, 0x41, 0x6c, 0x6c, 0x20, 0x6d, 0x69, 0x6d, 0x73, 0x79, 0x20, 0x77,
        0x65, 0x72, 0x65, 0x20, 0x74, 0x68, 0x65, 0x20, 0x62, 0x6f, 0x72, 0x6f, 0x67, 0x6f, 0x76, 0x65,
        0x73, 0x2c, 0x0a, 0x41, 0x6e, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x6d, 0x6f, 0x6d, 0x65, 0x20,
        0x72, 0x61, 0x74, 0x68, 0x73, 0x20, 0x6f, 0x75, 0x74, 0x67, 0x72, 0x61, 0x62, 0x65, 0x2e
    };

    const unsigned char exp_mac4[] = {
        0x45, 0x41, 0x66, 0x9a, 0x7e, 0xaa, 0xee, 0x61,
        0xe7, 0x08, 0xdc, 0x7c, 0xbc, 0xc5, 0xeb, 0x62
    };
    
    poly1305_init(&ctx, key4, sizeof(key4));
    poly1305_compute_mac(&ctx, plaintext4, sizeof(plaintext4), mac, 16);
    if(memcmp(mac, exp_mac4, sizeof(exp_mac4))){
        failed = 1;
        print_failed("Poly1305 test 4 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac4, sizeof(exp_mac4), "expected mac");
    } else {
        print_passed("Poly1305 test 4 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }

    const unsigned char key5[] = {
        0x85, 0xd6, 0xbe, 0x78, 0x57, 0x55, 0x6d, 0x33, 
        0x7f, 0x44, 0x52, 0xfe, 0x42, 0xd5, 0x06, 0xa8, 
        0x01, 0x03, 0x80, 0x8a, 0xfb, 0x0d, 0xb2, 0xfd, 
        0x4a, 0xbf, 0xf6, 0xaf, 0x41, 0x49, 0xf5, 0x1b
    };
    const unsigned char plaintext5[] = {
        0x43, 0x72, 0x79, 0x70, 0x74, 0x6f, 0x67, 0x72, 
        0x61, 0x70, 0x68, 0x69, 0x63, 0x20, 0x46, 0x6f, 
        0x72, 0x75, 0x6d, 0x20, 0x52, 0x65, 0x73, 0x65, 
        0x61, 0x72, 0x63, 0x68, 0x20, 0x47, 0x72, 0x6f, 
        0x75, 0x70
    };

    const unsigned char exp_mac5[] = {
        0xa8, 0x06, 0x1d, 0xc1, 0x30, 0x51, 0x36, 0xc6, 
        0xc2, 0x2b, 0x8b, 0xaf, 0x0c, 0x01, 0x27, 0xa9
    };
    
    poly1305_init(&ctx, key5, sizeof(key5));
    poly1305_compute_mac(&ctx, plaintext5, sizeof(plaintext5), mac, 16);
    if(memcmp(mac, exp_mac5, sizeof(exp_mac5))){
        failed = 1;
        print_failed("Poly1305 test 5 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac5, sizeof(exp_mac5), "expected mac");
    } else {
        print_passed("Poly1305 test 5 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }

    const unsigned char text[] = {
        0x50, 0x51, 0x52, 0x53, 0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7, 0x00, 0x00, 0x00, 0x00,
        0xd3, 0x1a, 0x8d, 0x34, 0x64, 0x8e, 0x60, 0xdb, 0x7b, 0x86, 0xaf, 0xbc, 0x53, 0xef, 0x7e, 0xc2,
        0xa4, 0xad, 0xed, 0x51, 0x29, 0x6e, 0x08, 0xfe, 0xa9, 0xe2, 0xb5, 0xa7, 0x36, 0xee, 0x62, 0xd6,
        0x3d, 0xbe, 0xa4, 0x5e, 0x8c, 0xa9, 0x67, 0x12, 0x82, 0xfa, 0xfb, 0x69, 0xda, 0x92, 0x72, 0x8b,
        0x1a, 0x71, 0xde, 0x0a, 0x9e, 0x06, 0x0b, 0x29, 0x05, 0xd6, 0xa5, 0xb6, 0x7e, 0xcd, 0x3b, 0x36,
        0x92, 0xdd, 0xbd, 0x7f, 0x2d, 0x77, 0x8b, 0x8c, 0x98, 0x03, 0xae, 0xe3, 0x28, 0x09, 0x1b, 0x58,
        0xfa, 0xb3, 0x24, 0xe4, 0xfa, 0xd6, 0x75, 0x94, 0x55, 0x85, 0x80, 0x8b, 0x48, 0x31, 0xd7, 0xbc,
        0x3f, 0xf4, 0xde, 0xf0, 0x8e, 0x4b, 0x7a, 0x9d, 0xe5, 0x76, 0xd2, 0x65, 0x86, 0xce, 0xc6, 0x4b,
        0x61, 0x16, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x72, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    
    const unsigned char key6[] = {
        0x7b, 0xac, 0x2b, 0x25, 0x2d, 0xb4, 0x47, 0xaf, 0x09, 0xb6, 0x7a, 0x55, 0xa4, 0xe9, 0x55, 0x84,
        0x0a, 0xe1, 0xd6, 0x73, 0x10, 0x75, 0xd9, 0xeb, 0x2a, 0x93, 0x75, 0x78, 0x3e, 0xd5, 0x53, 0xff
    };

    const unsigned char exp_mac6[] = {
        0x1a, 0xe1, 0x0b, 0x59, 0x4f, 0x09, 0xe2, 0x6a, 0x7e, 0x90, 0x2e, 0xcb, 0xd0, 0x60, 0x06, 0x91
    }; 
    poly1305_init(&ctx, key6, sizeof(key6));
    poly1305_compute_mac(&ctx, text, sizeof(text), mac, 16);
    if(memcmp(mac, exp_mac6, sizeof(exp_mac6))){
        failed = 1;
        print_failed("Poly1305 test 6 failed");
        print_bytes_array(mac, sizeof(mac), "mac");
        print_bytes_array(exp_mac6, sizeof(exp_mac6), "expected mac");
    } else {
        print_passed("Poly1305 test 6 passed");
        print_bytes_array(mac, sizeof(mac), "mac");
    }
    return failed;
}

int chacha20_poly1305_test(){
    int failed = 0;

    const unsigned char plaintext[] = {
        0x4c, 0x61, 0x64, 0x69, 0x65, 0x73, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x47, 0x65, 0x6e, 0x74, 0x6c, 
        0x65, 0x6d, 0x65, 0x6e, 0x20, 0x6f, 0x66, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6c, 0x61, 0x73, 
        0x73, 0x20, 0x6f, 0x66, 0x20, 0x27, 0x39, 0x39, 0x3a, 0x20, 0x49, 0x66, 0x20, 0x49, 0x20, 0x63, 
        0x6f, 0x75, 0x6c, 0x64, 0x20, 0x6f, 0x66, 0x66, 0x65, 0x72, 0x20, 0x79, 0x6f, 0x75, 0x20, 0x6f, 
        0x6e, 0x6c, 0x79, 0x20, 0x6f, 0x6e, 0x65, 0x20, 0x74, 0x69, 0x70, 0x20, 0x66, 0x6f, 0x72, 0x20, 
        0x74, 0x68, 0x65, 0x20, 0x66, 0x75, 0x74, 0x75, 0x72, 0x65, 0x2c, 0x20, 0x73, 0x75, 0x6e, 0x73, 
        0x63, 0x72, 0x65, 0x65, 0x6e, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20, 0x62, 0x65, 0x20, 0x69, 
        0x74, 0x2e
    };

    const unsigned char aad[] = {
        0x50, 0x51, 0x52, 0x53, 0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7
    };

    const unsigned char key[] = {
        0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8a, 0x8b, 
        0x8c, 0x8d, 0x8e, 0x8f, 0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 
        0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f
    };

    const unsigned char iv[] = {
        0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47
    };

    const unsigned char constant[] = {
        0x07, 0x00, 0x00, 0x00   
    };

    unsigned char exp_aead_output[] = {
        0xd3, 0x1a, 0x8d, 0x34, 0x64, 0x8e, 0x60, 0xdb, 0x7b, 0x86, 0xaf, 0xbc, 0x53, 0xef, 0x7e, 0xc2,
        0xa4, 0xad, 0xed, 0x51, 0x29, 0x6e, 0x08, 0xfe, 0xa9, 0xe2, 0xb5, 0xa7, 0x36, 0xee, 0x62, 0xd6,
        0x3d, 0xbe, 0xa4, 0x5e, 0x8c, 0xa9, 0x67, 0x12, 0x82, 0xfa, 0xfb, 0x69, 0xda, 0x92, 0x72, 0x8b,
        0x1a, 0x71, 0xde, 0x0a, 0x9e, 0x06, 0x0b, 0x29, 0x05, 0xd6, 0xa5, 0xb6, 0x7e, 0xcd, 0x3b, 0x36,
        0x92, 0xdd, 0xbd, 0x7f, 0x2d, 0x77, 0x8b, 0x8c, 0x98, 0x03, 0xae, 0xe3, 0x28, 0x09, 0x1b, 0x58,
        0xfa, 0xb3, 0x24, 0xe4, 0xfa, 0xd6, 0x75, 0x94, 0x55, 0x85, 0x80, 0x8b, 0x48, 0x31, 0xd7, 0xbc,
        0x3f, 0xf4, 0xde, 0xf0, 0x8e, 0x4b, 0x7a, 0x9d, 0xe5, 0x76, 0xd2, 0x65, 0x86, 0xce, 0xc6, 0x4b,
        0x61, 0x16, 0x1a, 0xe1, 0x0b, 0x59, 0x4f, 0x09, 0xe2, 0x6a, 0x7e, 0x90, 0x2e, 0xcb, 0xd0, 0x60, 
        0x06, 0x91
    };


    unsigned char ciphertext[114] = {0};
    unsigned char decrypted_text[114] = {0};
    unsigned char aead_output[130] = {0};
    
    crypt_chacha20_poly1305_encrypt(iv, sizeof(iv),
                                    aad, sizeof(aad),
                                    key, sizeof(key),
                                    constant, sizeof(constant),
                                    plaintext, sizeof(plaintext),
                                    ciphertext, sizeof(ciphertext),
                                    aead_output, sizeof(aead_output));
    
    if(memcmp(aead_output, exp_aead_output, sizeof(aead_output))){
        failed = 1;
        print_failed("chacha20_poly1305 encryption test 1 failed");
        print_bytes_array(aead_output, sizeof(aead_output), "aead output");
        print_bytes_array(exp_aead_output, sizeof(exp_aead_output), "expected aead output");
    } else {
        print_passed("chacha20_poly1305 encryption test 1 passed");
        print_bytes_array(aead_output, sizeof(aead_output), "aead_output");
    }

    crypt_chacha20_poly1305_decrypt(iv, sizeof(iv), 
                                    aad, sizeof(aad),
                                    key, sizeof(key),
                                    constant, sizeof(constant),
                                    aead_output, sizeof(aead_output),
                                    decrypted_text, sizeof(decrypted_text));
    if(memcmp(decrypted_text, plaintext, sizeof(plaintext))){
        failed = 1;
        print_failed("chacha20_poly1305 decryption test 1 failed");
        print_bytes_array(decrypted_text, sizeof(decrypted_text), "decrypted_text");
        print_bytes_array(plaintext, sizeof(plaintext), "expected plaintext");
    } else {
        print_passed("chacha20_poly1305 decryption test 1 passed");
        print_bytes_array(decrypted_text, sizeof(decrypted_text), "decrypted_text");
    }

    const unsigned char key2[] = {
        0x1c, 0x92, 0x40, 0xa5, 0xeb, 0x55, 0xd3, 0x8a, 0xf3, 0x33, 0x88, 0x86, 0x04, 0xf6, 0xb5, 0xf0,
        0x47, 0x39, 0x17, 0xc1, 0x40, 0x2b, 0x80, 0x09, 0x9d, 0xca, 0x5c, 0xbc, 0x20, 0x70, 0x75, 0xc0
    };

    unsigned char aead_encrypted_text[] = {
        0x64, 0xa0, 0x86, 0x15, 0x75, 0x86, 0x1a, 0xf4, 0x60, 0xf0, 0x62, 0xc7, 0x9b, 0xe6, 0x43, 0xbd,
        0x5e, 0x80, 0x5c, 0xfd, 0x34, 0x5c, 0xf3, 0x89, 0xf1, 0x08, 0x67, 0x0a, 0xc7, 0x6c, 0x8c, 0xb2,
        0x4c, 0x6c, 0xfc, 0x18, 0x75, 0x5d, 0x43, 0xee, 0xa0, 0x9e, 0xe9, 0x4e, 0x38, 0x2d, 0x26, 0xb0,
        0xbd, 0xb7, 0xb7, 0x3c, 0x32, 0x1b, 0x01, 0x00, 0xd4, 0xf0, 0x3b, 0x7f, 0x35, 0x58, 0x94, 0xcf,
        0x33, 0x2f, 0x83, 0x0e, 0x71, 0x0b, 0x97, 0xce, 0x98, 0xc8, 0xa8, 0x4a, 0xbd, 0x0b, 0x94, 0x81,
        0x14, 0xad, 0x17, 0x6e, 0x00, 0x8d, 0x33, 0xbd, 0x60, 0xf9, 0x82, 0xb1, 0xff, 0x37, 0xc8, 0x55,
        0x97, 0x97, 0xa0, 0x6e, 0xf4, 0xf0, 0xef, 0x61, 0xc1, 0x86, 0x32, 0x4e, 0x2b, 0x35, 0x06, 0x38,
        0x36, 0x06, 0x90, 0x7b, 0x6a, 0x7c, 0x02, 0xb0, 0xf9, 0xf6, 0x15, 0x7b, 0x53, 0xc8, 0x67, 0xe4,
        0xb9, 0x16, 0x6c, 0x76, 0x7b, 0x80, 0x4d, 0x46, 0xa5, 0x9b, 0x52, 0x16, 0xcd, 0xe7, 0xa4, 0xe9,
        0x90, 0x40, 0xc5, 0xa4, 0x04, 0x33, 0x22, 0x5e, 0xe2, 0x82, 0xa1, 0xb0, 0xa0, 0x6c, 0x52, 0x3e,
        0xaf, 0x45, 0x34, 0xd7, 0xf8, 0x3f, 0xa1, 0x15, 0x5b, 0x00, 0x47, 0x71, 0x8c, 0xbc, 0x54, 0x6a,
        0x0d, 0x07, 0x2b, 0x04, 0xb3, 0x56, 0x4e, 0xea, 0x1b, 0x42, 0x22, 0x73, 0xf5, 0x48, 0x27, 0x1a,
        0x0b, 0xb2, 0x31, 0x60, 0x53, 0xfa, 0x76, 0x99, 0x19, 0x55, 0xeb, 0xd6, 0x31, 0x59, 0x43, 0x4e,
        0xce, 0xbb, 0x4e, 0x46, 0x6d, 0xae, 0x5a, 0x10, 0x73, 0xa6, 0x72, 0x76, 0x27, 0x09, 0x7a, 0x10,
        0x49, 0xe6, 0x17, 0xd9, 0x1d, 0x36, 0x10, 0x94, 0xfa, 0x68, 0xf0, 0xff, 0x77, 0x98, 0x71, 0x30,
        0x30, 0x5b, 0xea, 0xba, 0x2e, 0xda, 0x04, 0xdf, 0x99, 0x7b, 0x71, 0x4d, 0x6c, 0x6f, 0x2c, 0x29,
        0xa6, 0xad, 0x5c, 0xb4, 0x02, 0x2b, 0x02, 0x70, 0x9b, 0xee, 0xad, 0x9d, 0x67, 0x89, 0x0c, 0xbb, 
        0x22, 0x39, 0x23, 0x36, 0xfe, 0xa1, 0x85, 0x1f, 0x38    
    };

    const unsigned char constant2[4] = {
        0x00, 0x00, 0x00, 0x00
    };

    const unsigned char iv2[8] ={
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08
    };

    const unsigned char aad2[] = {
        0xf3, 0x33, 0x88, 0x86, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x91
    };

    const unsigned char exp_plaintext2[] = {
        0x49, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65, 0x74, 0x2d, 0x44, 0x72, 0x61, 0x66, 0x74, 0x73, 0x20,  
        0x61, 0x72, 0x65, 0x20, 0x64, 0x72, 0x61, 0x66, 0x74, 0x20, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65,  
        0x6e, 0x74, 0x73, 0x20, 0x76, 0x61, 0x6c, 0x69, 0x64, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x61, 0x20,  
        0x6d, 0x61, 0x78, 0x69, 0x6d, 0x75, 0x6d, 0x20, 0x6f, 0x66, 0x20, 0x73, 0x69, 0x78, 0x20, 0x6d,  
        0x6f, 0x6e, 0x74, 0x68, 0x73, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x6d, 0x61, 0x79, 0x20, 0x62, 0x65,  
        0x20, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65, 0x64, 0x2c, 0x20, 0x72, 0x65, 0x70, 0x6c, 0x61, 0x63,  
        0x65, 0x64, 0x2c, 0x20, 0x6f, 0x72, 0x20, 0x6f, 0x62, 0x73, 0x6f, 0x6c, 0x65, 0x74, 0x65, 0x64,  
        0x20, 0x62, 0x79, 0x20, 0x6f, 0x74, 0x68, 0x65, 0x72, 0x20, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65,  
        0x6e, 0x74, 0x73, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e, 0x79, 0x20, 0x74, 0x69, 0x6d, 0x65, 0x2e,  
        0x20, 0x49, 0x74, 0x20, 0x69, 0x73, 0x20, 0x69, 0x6e, 0x61, 0x70, 0x70, 0x72, 0x6f, 0x70, 0x72,  
        0x69, 0x61, 0x74, 0x65, 0x20, 0x74, 0x6f, 0x20, 0x75, 0x73, 0x65, 0x20, 0x49, 0x6e, 0x74, 0x65, 
        0x72, 0x6e, 0x65, 0x74, 0x2d, 0x44, 0x72, 0x61, 0x66, 0x74, 0x73, 0x20, 0x61, 0x73, 0x20, 0x72, 
        0x65, 0x66, 0x65, 0x72, 0x65, 0x6e, 0x63, 0x65, 0x20, 0x6d, 0x61, 0x74, 0x65, 0x72, 0x69, 0x61,  
        0x6c, 0x20, 0x6f, 0x72, 0x20, 0x74, 0x6f, 0x20, 0x63, 0x69, 0x74, 0x65, 0x20, 0x74, 0x68, 0x65,  
        0x6d, 0x20, 0x6f, 0x74, 0x68, 0x65, 0x72, 0x20, 0x74, 0x68, 0x61, 0x6e, 0x20, 0x61, 0x73, 0x20,  
        0x2f, 0xe2, 0x80, 0x9c, 0x77, 0x6f, 0x72, 0x6b, 0x20, 0x69, 0x6e, 0x20, 0x70, 0x72, 0x6f, 0x67,  
        0x72, 0x65, 0x73, 0x73, 0x2e, 0x2f, 0xe2, 0x80, 0x9d,                 
    };

    unsigned char plaintext2[265] = {0}; 
    unsigned char ciphertext2[265] = {0};
    unsigned char aead_output2[281] = {0};

    crypt_chacha20_poly1305_decrypt(iv2, sizeof(iv2), 
                                    aad2, sizeof(aad2),
                                    key2, sizeof(key2),
                                    constant2, sizeof(constant2),
                                    aead_encrypted_text, sizeof(aead_encrypted_text),
                                    plaintext2, sizeof(plaintext2));
    if(memcmp(plaintext2, exp_plaintext2, sizeof(exp_plaintext2))){
        failed = 1;
        print_failed("chacha20_poly1305 decryption test 2 failed");
        print_bytes_array(plaintext2, sizeof(plaintext2), "decrypted_text");
        print_bytes_array(exp_plaintext2, sizeof(exp_plaintext2), "expected plaintext");
    } else {
        print_passed("chacha20_poly1305 decryption test 1 passed");
        print_bytes_array(plaintext2, sizeof(plaintext2), "decrypted_text");
    }

    crypt_chacha20_poly1305_encrypt(iv2, sizeof(iv2),
                                    aad2, sizeof(aad2),
                                    key2, sizeof(key2),
                                    constant2, sizeof(constant2),
                                    exp_plaintext2, sizeof(exp_plaintext2),
                                    ciphertext2, sizeof(ciphertext2),
                                    aead_output2, sizeof(aead_output2));
    failed = assert_eq_texts(aead_output2, aead_encrypted_text, sizeof(aead_encrypted_text), " ");
    print_bytes_array(aead_output2, sizeof(aead_output2), "aead_output");

    return failed;
}       


int des_test(){
    int failed = 0;
    
    unsigned char plaintext1[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74,
    };
    unsigned char ciphertext1[] = {
        0x3F, 0xA4, 0x0E, 0x8A, 0x98, 0x4D, 0x48, 0x15
    };
    unsigned char ciphertext1_cbc[] = {
        0x3F, 0xA4, 0x0E, 0x8A, 0x98, 0x4D, 0x48, 0x15
    };
    uint64_t iv = 0x0000000000000000;
    unsigned char cipher1[8] = {0};
    unsigned char cipher1_cbc[16] = {0};
    unsigned char plain1[8] = {0};
    unsigned char plain1_cbc[16] = {0};
    uint64_t key = 0x0123456789ABCDEF;
    crypt_DES_encrypt(key, 0, plaintext1, sizeof(plaintext1), cipher1, sizeof(cipher1), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1, ciphertext1, sizeof(ciphertext1), "DES-encryption ECB 1");

    crypt_DES_decrypt(key, 0, ciphertext1, sizeof(ciphertext1), plain1, sizeof(plain1), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1, plaintext1, sizeof(plaintext1), "DES-decryption ECB 1");

    crypt_DES_encrypt(key, iv, plaintext1, sizeof(plaintext1), cipher1_cbc, sizeof(cipher1_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher1_cbc, ciphertext1_cbc, sizeof(ciphertext1_cbc), "DES-encryption CBC 1");

    crypt_DES_decrypt(key, iv, ciphertext1_cbc, sizeof(ciphertext1_cbc), plain1_cbc, sizeof(plain1_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain1_cbc, plaintext1, sizeof(plaintext1), "DES-decryption CBC 1");

    unsigned char plaintext2[] = {
        0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 
        0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, 0x00
    };
    unsigned char ciphertext2[16] = {
        0xB5, 0x21, 0x9E, 0xE8, 0x1A, 0xA7, 0x49, 0x9D, 
        0x21, 0x96, 0x68, 0x7E, 0x13, 0x97, 0x38, 0x56
    };
    unsigned char ciphertext2_cbc[16] = {
        0xEA, 0xFD, 0x7D, 0x68, 0x32, 0x34, 0xF5, 0x79, 
        0x8F, 0x74, 0xA9, 0x8B, 0x9F, 0x4F, 0x03, 0xA9
    };
    uint64_t iv2 = 0x1234567890ABCDEF;
    unsigned char cipher2[16] = {0};
    unsigned char cipher2_cbc[24] = {0};
    unsigned char plain2[16] = {0}; 
    unsigned char plain2_cbc[16] = {0};
    uint64_t key2 = 0x752878397493CB70;
    crypt_DES_encrypt(key2, 0, plaintext2, sizeof(plaintext2), cipher2, sizeof(cipher2), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher2, ciphertext2, sizeof(ciphertext2), "DES-encryption ECB 2");

    crypt_DES_decrypt(key2, 0, ciphertext2, sizeof(ciphertext2), plain2, sizeof(plain2), NO_PAD, ECB);
    failed |= assert_eq_texts(plain2, plaintext2, sizeof(plaintext2), "DES-decryption ECB 2");

    crypt_DES_encrypt(key2, iv2, plaintext2, sizeof(plaintext2), cipher2_cbc, sizeof(cipher2_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher2_cbc, ciphertext2_cbc, sizeof(ciphertext2_cbc), "DES-encryption CBC 2");

    crypt_DES_decrypt(key2, iv2, ciphertext2_cbc, sizeof(ciphertext2_cbc), plain2_cbc, sizeof(plain2_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain2_cbc, plaintext2, sizeof(plaintext2), "DES-decryption CBC 2");

    unsigned char plaintext3[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74,
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00
    };
    unsigned char ciphertext3[] = {
        0x3F, 0xA4, 0x0E, 0x8A, 0x98, 0x4D, 0x48, 0x15, 
        0x6A, 0x27, 0x17, 0x87, 0xAB, 0x88, 0x83, 0xF9, 
        0xB1, 0xCB, 0xC8, 0x07, 0x56, 0x55, 0x70, 0x58
    };
    unsigned char ciphertext3_cbc[] = {
        0x7F, 0x81, 0x65, 0x41, 0x21, 0xDB, 0xD4, 0xCF, 
        0xA8, 0xE9, 0x88, 0x4F, 0x76, 0x72, 0x2A, 0xCD, 
        0xBE, 0x42, 0x4F, 0x90, 0x86, 0x24, 0x3F, 0x35
    };
    uint64_t iv3 = 0xFEDCBA9876543210;
    unsigned char cipher3[24] = {0};
    unsigned char cipher3_cbc[32] = {0};
    unsigned char plain3[24] = {0};
    unsigned char plain3_cbc[32] = {0};
    uint64_t key3 = 0x0123456789ABCDEF;
    crypt_DES_encrypt(key3, 0, plaintext3, sizeof(plaintext3), cipher3, sizeof(cipher3), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher3, ciphertext3, sizeof(ciphertext3), "DES-encryption ECB 3");

    crypt_DES_decrypt(key3, 0, ciphertext3, sizeof(ciphertext3), plain3, sizeof(plain3), NO_PAD, ECB);
    failed |= assert_eq_texts(plain3, plaintext3, sizeof(plaintext3), "DES-decryption ECB 3");

    crypt_DES_encrypt(key3, iv3, plaintext3, sizeof(plaintext3), cipher3_cbc, sizeof(cipher3_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher3_cbc, ciphertext3_cbc, sizeof(ciphertext3_cbc), "DES-encryption CBC 3");

    crypt_DES_decrypt(key3, iv3, ciphertext3_cbc, sizeof(ciphertext3_cbc), plain3_cbc, sizeof(plain3_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain3_cbc, plaintext3, sizeof(plaintext3), "DES-decryption CBC 3");

    unsigned char plaintext4[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00, 
        0x66, 0x6F, 0x72, 0x20, 0x61
    };
    unsigned char ciphertext4[] = {
        0x7F, 0x81, 0x65, 0x41, 0x21, 0xDB, 0xD4, 0xCF, 
        0xA8, 0xE9, 0x88, 0x4F, 0x76, 0x72, 0x2A, 0xCD, 
        0xBE, 0x42, 0x4F, 0x90, 0x86, 0x24, 0x3F, 0x35, 
        0x83, 0x81, 0x54, 0x60, 0x92, 0x60, 0x8F, 0xE0
    };
    uint64_t iv4 = 0xFEDCBA9876543210;
    unsigned char cipher4_cbc[32] = {0};
    unsigned char plain4_cbc[29] = {0};
    uint64_t key4 = 0x0123456789ABCDEF;
    printf("key1 %lX\n", key4);
    crypt_DES_encrypt(key4, iv4, plaintext4, sizeof(plaintext4), cipher4_cbc, sizeof(cipher4_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher4_cbc, ciphertext4, sizeof(ciphertext4), "DES-encryption CBC 4");

    crypt_DES_decrypt(key4, iv4, ciphertext4, sizeof(ciphertext4), plain4_cbc, sizeof(plain4_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain4_cbc, plaintext4, sizeof(plaintext4), "DES-decryption CBC 4");

    return failed;
}

int tdes_test(){
    int failed = 0;

    unsigned char plaintext1[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74,
    };

    // unsigned char keys[] = {
    //     0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
    //     0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70, 
    //     0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    // };

    unsigned char ciphertext1[] = {
        0x31, 0x60, 0xF1, 0x8C, 0x37, 0x87, 0xAA, 0xB2
    };

    unsigned char ciphertext1_cbc[] = {
        0x31, 0x60, 0xF1, 0x8C, 0x37, 0x87, 0xAA, 0xB2
    };

    uint64_t iv = 0x0000000000000000;

    uint64_t key1 = 0x0123456789ABCDEF;
    uint64_t key2 = 0x752878397493CB70;
    uint64_t key3 = 0x0123456789ABCDEF;
    // endianness needs to be accounted for if using the key as a byte array
    // memcpy(&key1, keys, 8);
    // memcpy(&key2, &keys[8], 8);
    // memcpy(&key3, &keys[16], 8);

    unsigned char cipher1_ecb[8] = {0};
    unsigned char plain1_ecb[8] = {0};
    unsigned char cipher1_cbc[16] = {0};
    unsigned char plain1_cbc[8] = {0};
    crypt_TDES_encrypt(key1, key2, key3, 0, plaintext1, sizeof(plaintext1), cipher1_ecb, sizeof(cipher1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1_ecb, ciphertext1, sizeof(ciphertext1), "3DES-encryption ECB 1");

    crypt_TDES_decrypt(key1, key2, key3, 0, ciphertext1, sizeof(ciphertext1), plain1_ecb, sizeof(plain1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1_ecb, plaintext1, sizeof(plaintext1), "3DES-decryption ECB 1");

    crypt_TDES_encrypt(key1 ,key2, key3, iv, plaintext1, sizeof(plaintext1), cipher1_cbc, sizeof(cipher1_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher1_cbc, ciphertext1_cbc, sizeof(ciphertext1_cbc), "3DES-encryption CBC 1");

    crypt_TDES_decrypt(key1, key2, key3, iv, ciphertext1_cbc, sizeof(ciphertext1_cbc), plain1_cbc, sizeof(plain1_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain1_cbc, plaintext1, sizeof(plaintext1), "3DES-decryption CBC 1");

    unsigned char plaintext2[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00
    };
    unsigned char ciphertext2[] = {
        0x31, 0x60, 0xF1, 0x8C, 0x37, 0x87, 0xAA, 0xB2, 
        0x6C, 0x67, 0x70, 0x1C, 0xD8, 0x06, 0x4C, 0x9C, 
        0x50, 0x01, 0x8E, 0x38, 0x7D, 0x45, 0x42, 0x93
    };
    unsigned char ciphertext2_cbc[] = {
        0xE6, 0x34, 0x0A, 0x46, 0xAE, 0xCC, 0xF9, 0xFB, 
        0xCC, 0x3A, 0xB8, 0x07, 0x7B, 0x7A, 0x8B, 0x3A, 
        0x8F, 0xC4, 0xFC, 0x72, 0x39, 0x75, 0x86, 0x9E
    };
    uint64_t iv2 = 0x1234567890ABCDEF;
    unsigned char cipher2_ecb[24] = {0};
    unsigned char plain2_ecb[24] = {0};
    unsigned char cipher2_cbc[32] = {0};
    unsigned char plain2_cbc[24] = {0};
    crypt_TDES_encrypt(key1, key2, key3, 0, plaintext2, sizeof(plaintext2), cipher2_ecb, sizeof(cipher2_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher2_ecb, ciphertext2, sizeof(ciphertext2), "3DES-encryption ECB 2");

    crypt_TDES_decrypt(key1, key2, key3, 0, ciphertext2, sizeof(ciphertext2), plain2_ecb, sizeof(plain2_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(plain2_ecb, plaintext2, sizeof(plaintext2), "3DES-decryption ECB 2");

    crypt_TDES_encrypt(key1 ,key2, key3, iv2, plaintext2, sizeof(plaintext2), cipher2_cbc, sizeof(cipher2_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher2_cbc, ciphertext2_cbc, sizeof(ciphertext2_cbc), "3DES-encryption CBC 2");

    crypt_TDES_decrypt(key1, key2, key3, iv2, ciphertext2_cbc, sizeof(ciphertext2_cbc), plain2_cbc, sizeof(plain2_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain2_cbc, plaintext2, sizeof(plaintext2), "3DES-decryption CBC 2");

    unsigned char plaintext3[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00, 
        0x66, 0x6F, 0x72, 0x20, 0x61
    };
    unsigned char ciphertext3_cbc[] = {
        0xE6, 0x34, 0x0A, 0x46, 0xAE, 0xCC, 0xF9, 0xFB, 
        0xCC, 0x3A, 0xB8, 0x07, 0x7B, 0x7A, 0x8B, 0x3A, 
        0x8F, 0xC4, 0xFC, 0x72, 0x39, 0x75, 0x86, 0x9E, 
        0x9D, 0x12, 0xA4, 0xC3, 0xFB, 0xE8, 0x42, 0x92
    };
    unsigned char cipher3_cbc[32] = {0};
    unsigned char plain3_cbc[29] = {0};
    uint64_t iv3 = 0x1234567890ABCDEF;

    crypt_TDES_encrypt(key1 ,key2, key3, iv3, plaintext3, sizeof(plaintext3), cipher3_cbc, sizeof(cipher3_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(cipher3_cbc, ciphertext3_cbc, sizeof(ciphertext3_cbc), "3DES-encryption CBC 2");

    crypt_TDES_decrypt(key1, key2, key3, iv3, ciphertext3_cbc, sizeof(ciphertext3_cbc), plain3_cbc, sizeof(plain3_cbc), NO_PAD, CBC);
    failed |= assert_eq_texts(plain3_cbc, plaintext3, sizeof(plaintext3), "3DES-decryption CBC 3");

    return failed;
}

int aes_test(){
    int failed = 0;

    const uint8_t key1_128[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c
    };

    const uint8_t key1_192[] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17
    };

    const uint8_t key1_256[] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f
    };

    const uint8_t key2_128[] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
    };

    const uint8_t plaintext1[] = {
        0x32, 0x43, 0xf6, 0xa8, 0x88, 0x5a, 0x30, 0x8d,
        0x31, 0x31, 0x98, 0xa2, 0xe0, 0x37, 0x07, 0x34
    };

    const uint8_t plaintext2[] = {
        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
        0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff
    };

    const uint8_t ciphertext1_ecb[] = {
        0x39, 0x25, 0x84, 0x1D, 0x02, 0xDC, 0x09, 0xFB,
        0xDC, 0x11, 0x85, 0x97, 0x19, 0x6A, 0x0B, 0x32
    }; 

    const uint8_t ciphertext1_ecb_128[] = {
        0x69, 0xc4, 0xe0, 0xd8, 0x6a, 0x7b, 0x04, 0x30,
        0xd8, 0xcd, 0xb7, 0x80, 0x70, 0xb4, 0xc5, 0x5a
    };

    const uint8_t ciphertext1_ecb_192[] = {
        0xdd, 0xa9, 0x7c, 0xa4, 0x86, 0x4c, 0xdf, 0xe0,
        0x6e, 0xaf, 0x70, 0xa0, 0xec, 0x0d, 0x71, 0x91
    };

    const uint8_t ciphertext1_ecb_256[] = {
        0x8e, 0xa2, 0xb7, 0xca, 0x51, 0x67, 0x45, 0xbf,
        0xea, 0xfc, 0x49, 0x90, 0x4b, 0x49, 0x60, 0x89
    };

    uint8_t plain1[16];
    uint8_t cipher1_ecb[16];
   
    crypt_AES_encrypt(key1_128, sizeof(key1_128), AES_128, NULL, 0, NULL, 0, plaintext1, sizeof(plaintext1), cipher1_ecb, sizeof(cipher1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1_ecb, ciphertext1_ecb, sizeof(ciphertext1_ecb), "AES-128-ECB encryption test 1 NO_PAD");

    crypt_AES_encrypt(key2_128, sizeof(key2_128), AES_128, NULL, 0, NULL, 0, plaintext2, sizeof(plaintext2), cipher1_ecb, sizeof(cipher1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1_ecb, ciphertext1_ecb_128, sizeof(ciphertext1_ecb_128), "AES-128-ECB encryption test 2 NO_PAD");

    crypt_AES_encrypt(key1_192, sizeof(key1_192), AES_192, NULL, 0, NULL, 0, plaintext2, sizeof(plaintext2), cipher1_ecb, sizeof(cipher1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1_ecb, ciphertext1_ecb_192, sizeof(ciphertext1_ecb_192), "AES-192-ECB encryption test 1 NO_PAD");

    crypt_AES_encrypt(key1_256, sizeof(key1_256), AES_256, NULL, 0, NULL, 0, plaintext2, sizeof(plaintext2), cipher1_ecb, sizeof(cipher1_ecb), NO_PAD, ECB);
    failed |= assert_eq_texts(cipher1_ecb, ciphertext1_ecb_256, sizeof(ciphertext1_ecb_256), "AES-256-ECB encryption test 1 NO_PAD");

    crypt_AES_decrypt(key2_128, sizeof(key2_128), AES_128, NULL, 0, ciphertext1_ecb_128, sizeof(ciphertext1_ecb_128), plain1, sizeof(plain1), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1, plaintext2, sizeof(plaintext2), "AES-128-ECB decryption test 1 NO_PAD");

    crypt_AES_decrypt(key1_192, sizeof(key1_192), AES_192, NULL, 0, ciphertext1_ecb_192, sizeof(ciphertext1_ecb_192), plain1, sizeof(plain1), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1, plaintext2, sizeof(plaintext2), "AES-192-ECB decryption test 1 NO_PAD");

    crypt_AES_decrypt(key1_256, sizeof(key1_256), AES_192, NULL, 0, ciphertext1_ecb_256, sizeof(ciphertext1_ecb_256), plain1, sizeof(plain1), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1, plaintext2, sizeof(plaintext2), "AES-256-ECB decryption test 1 NO_PAD");

    crypt_AES_decrypt(key1_128, sizeof(key1_128), AES_128, NULL, 0, ciphertext1_ecb, sizeof(ciphertext1_ecb), plain1, sizeof(plain1), NO_PAD, ECB);
    failed |= assert_eq_texts(plain1, plaintext1, sizeof(plaintext1), "AES-128-ECB decryption test 2 NO_PAD");

    return failed;
}

int AES_CBC_test() {
    int failed = 0;

    const uint8_t iv1[] = {
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF, 
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF
    };

    const uint8_t iv2[] = {
        0x12, 0x34, 0x56, 0x78, 0x90, 0xAB, 0xCD, 0xEF, 
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF
    };

    const uint8_t iv3[] = {
        0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 0x01, 
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF
    };

    const uint8_t iv_cbc[] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
    };

    const uint8_t iv_cbc2[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70
    };

    const uint8_t key_128_1[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };

    const uint8_t key_192_1[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70
    };

    const uint8_t key_256_1[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70, 
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };

    const uint8_t key_128_cbc[] = {
        0x2B, 0x7E, 0x15, 0x16, 0x28, 0xAE, 0xD2, 0xA6,
        0xAB, 0xF7, 0x15, 0x88, 0x09, 0xCF, 0x4F, 0x3C
    };

    const uint8_t key_256_cbc[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70, 
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };

    const uint8_t plaintext3[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74,
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74
    };

    const uint8_t plaintext4[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74,
    };

    const uint8_t plaintext5[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00,
    };

    const uint8_t plaintext6[] = {
        0x4E, 0x6F, 0x77, 0x20, 0x69, 0x73, 0x20, 0x74, 
        0x68, 0x65, 0x20, 0x74, 0x69, 0x6D, 0x65, 0x20, 
        0x66, 0x6F, 0x72, 0x20, 0x61, 0x6C, 0x6C, 0x00, 
        0x66, 0x6F, 0x72, 0x20, 0x61
    };

    const uint8_t plaintext_cbc[] = {
        0x6B, 0xC1, 0xBE, 0xE2, 0x2E, 0x40, 0x9F, 0x96,
        0xE9, 0x3D, 0x7E, 0x11, 0x73, 0x93, 0x17, 0x2A,
        0xAE, 0x2D, 0x8A, 0x57, 0x1E, 0x03, 0xAC, 0x9C,
        0x9E, 0xB7, 0x6F, 0xAC, 0x45, 0xAF, 0x8E, 0x51,
        0x30, 0xC8, 0x1C, 0x46, 0xA3, 0x5C, 0xE4, 0x11,
        0xE5, 0xFB, 0xC1, 0x19, 0x1A, 0x0A, 0x52, 0xEF,
        0xF6, 0x9F, 0x24, 0x45, 0xDF, 0x4F, 0x9B, 0x17,
        0xAD, 0x2B, 0x41, 0x7B, 0xE6, 0x6C, 0x37, 0x10
    };

    const uint8_t plaintext_cbc2[] = "This is AES_CBC_256 test, with totally random key and totalyl random iv. oops that totally is spelt wrong lol... adding a couple more\
            letters to make this test longer";

    const uint8_t ciphertext3[] = {
        0x64, 0x4B, 0x48, 0x3E, 0xAC, 0x0E, 0x09, 0x28, 
        0x5B, 0xCE, 0xB3, 0xDE, 0xDE, 0x26, 0x5F, 0xC0
    };

    const uint8_t ciphertext4[] = {
        0xC4, 0x32, 0xBC, 0x0B, 0xB2, 0x02, 0x86, 0xD9, 
        0x2A, 0xFA, 0x74, 0xA1, 0xC6, 0xA2, 0x6A, 0x2B
    };

    const uint8_t ciphertext5[] = {
        0x35, 0xA0, 0x4F, 0x15, 0xF0, 0x63, 0x26, 0x2B, 
        0x72, 0xD3, 0xB4, 0xAA, 0x52, 0x49, 0xE0, 0x4B, 
        0xBC, 0xC2, 0x88, 0xD9, 0x6E, 0xF1, 0x96, 0xD9, 
        0x53, 0xFC, 0x3D, 0x73, 0xCD, 0x1F, 0xE6, 0xA3
    };

    const uint8_t ciphertext6[] = {
        0x46, 0x51, 0xA5, 0xAA, 0x50, 0x92, 0xBD, 0xE0, 
        0x91, 0xDE, 0xC2, 0xB4, 0x7E, 0x76, 0x98, 0x93, 
        0x57, 0xC5, 0x4B, 0x30, 0x4D, 0x9F, 0x9A, 0x59, 
        0xA4, 0xA8, 0x1D, 0x6E, 0xD4, 0x48, 0x13, 0x12
    };

    const uint8_t ciphertext_cbc[] = {
        0x76, 0x49, 0xAB, 0xAC, 0x81, 0x19, 0xB2, 0x46,
        0xCE, 0xE9, 0x8E, 0x9B, 0x12, 0xE9, 0x19, 0x7D,
        0x50, 0x86, 0xCB, 0x9B, 0x50, 0x72, 0x19, 0xEE,
        0x95, 0xDB, 0x11, 0x3A, 0x91, 0x76, 0x78, 0xB2,
        0x73, 0xBE, 0xD6, 0xB8, 0xE3, 0xC1, 0x74, 0x3B,
        0x71, 0x16, 0xE6, 0x9E, 0x22, 0x22, 0x95, 0x16,
        0x3F, 0xF1, 0xCA, 0xA1, 0x68, 0x1F, 0xAC, 0x09,
        0x12, 0x0E, 0xCA, 0x30, 0x75, 0x86, 0xE1, 0xA7
    };

    const uint8_t ciphertext2_cbc[] = {
        0x2D, 0xB6, 0x17, 0x3A, 0x01, 0x41, 0x07, 0x38, 
        0xE5, 0xBC, 0x0C, 0xBA, 0x9F, 0x35, 0x90, 0x34, 
        0xF3, 0x44, 0x63, 0x7B, 0xA8, 0x2E, 0x09, 0x2D, 
        0x99, 0x12, 0xC8, 0x76, 0x65, 0x84, 0x19, 0x14, 
        0x94, 0xBA, 0xD0, 0x3A, 0xEA, 0x2A, 0x36, 0x53, 
        0xB0, 0xFA, 0x99, 0xE3, 0x13, 0x5E, 0xEB, 0x80, 
        0xD7, 0x9C, 0x8E, 0x63, 0x28, 0xF0, 0xBA, 0xB9, 
        0x29, 0xD2, 0x36, 0xF4, 0x0F, 0xF3, 0xBC, 0x8B, 
        0xDB, 0xA1, 0xE1, 0x16, 0x5E, 0x76, 0x52, 0x47, 
        0x44, 0x2E, 0x5B, 0x01, 0x48, 0xC6, 0x91, 0x99, 
        0xD5, 0xE7, 0x7E, 0x79, 0xA2, 0x3B, 0xF3, 0x82, 
        0xE8, 0x99, 0x4B, 0x66, 0x2C, 0xAD, 0xD8, 0x22, 
        0xF8, 0x79, 0x0B, 0x31, 0x21, 0x84, 0x3F, 0x68, 
        0x44, 0x64, 0x79, 0x68, 0xEC, 0xE2, 0x7B, 0x33, 
        0x24, 0xC7, 0xB2, 0x3B, 0x77, 0xAC, 0xD6, 0xF0, 
        0xDF, 0x50, 0x36, 0x4D, 0x18, 0x82, 0xE9, 0xB1, 
        0xD7, 0x30, 0xFE, 0x08, 0x17, 0xBB, 0x28, 0x18, 
        0x92, 0x21, 0x66, 0x92, 0xE2, 0x33, 0xC8, 0x4E, 
        0x31, 0x35, 0x41, 0xA0, 0x2D, 0x8B, 0x6B, 0x1E, 
        0x2F, 0x01, 0x41, 0xCA, 0xA7, 0x0C, 0x97, 0xA8, 
        0xD0, 0x5C, 0x75, 0xF9, 0x2C, 0x43, 0xCA, 0x1D, 
        0x37, 0x37, 0x03, 0x32, 0x22, 0xDA, 0xEC, 0x99, 
        0x62, 0x46, 0xFB, 0x9D, 0xFC, 0xC4, 0x4F, 0x2F, 
        0x0D, 0x2A, 0x0B, 0x4A, 0x5E, 0x59, 0x68, 0x83
    };

    uint8_t cipher1_cbc[32];
    uint8_t cipher2_cbc[32];
    uint8_t cipher3_cbc[80];
    uint8_t cipher4_cbc[192];
    uint8_t plain1_cbc[16];
    uint8_t plain2_cbc[32];
    uint8_t plain3_cbc[80];
    uint8_t plain4_cbc[192];

    crypt_AES_encrypt(key_128_1, sizeof(key_128_1), AES_128, iv1, sizeof(iv1), NULL, 0, plaintext3, sizeof(plaintext3), cipher1_cbc, 32, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher1_cbc, ciphertext3, sizeof(ciphertext3), "AES-128-CBC encryption test 1");

    crypt_AES_decrypt(key_128_1, sizeof(key_128_1), AES_128, iv1, sizeof(iv1), ciphertext3, sizeof(ciphertext3), plain1_cbc, 16, NO_PAD, CBC);
    failed |= assert_eq_texts(plain1_cbc, plaintext3, sizeof(plaintext3), "AES-128-CBC decryption test 1");

    crypt_AES_encrypt(key_128_1, sizeof(key_128_1), AES_128, iv1, sizeof(iv1), NULL, 0, plaintext4, sizeof(plaintext4), cipher1_cbc, 16, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher1_cbc, ciphertext4, sizeof(ciphertext4), "AES-128-CBC encryption test 2");

    crypt_AES_decrypt(key_128_1, sizeof(key_128_1), AES_128, iv1, sizeof(iv1), ciphertext4, sizeof(ciphertext4), plain1_cbc, 16, NO_PAD, CBC);
    failed |= assert_eq_texts(plain1_cbc, plaintext4, sizeof(plaintext4), "AES-128-CBC decryption test 2");

    crypt_AES_encrypt(key_128_cbc, sizeof(key_128_cbc), AES_128, iv_cbc, sizeof(iv_cbc), NULL, 0, plaintext_cbc, sizeof(plaintext_cbc), cipher3_cbc, 80, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher3_cbc, ciphertext_cbc, sizeof(ciphertext_cbc), "AES-128-CBC encryption test 3");

    crypt_AES_decrypt(key_128_cbc, sizeof(key_128_cbc), AES_128, iv_cbc, sizeof(iv_cbc), cipher3_cbc, sizeof(cipher3_cbc), plain3_cbc, 80, NO_PAD, CBC);
    failed |= assert_eq_texts(plain3_cbc, plaintext_cbc, sizeof(plaintext_cbc), "AES-128-CBC decryption test 3");

    crypt_AES_encrypt(key_192_1, sizeof(key_192_1), AES_192, iv2, sizeof(iv2), NULL, 0, plaintext5, sizeof(plaintext5), cipher2_cbc, 32, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher2_cbc, ciphertext5, sizeof(ciphertext5), "AES-192-CBC encryption test 1");

    crypt_AES_decrypt(key_192_1, sizeof(key_192_1), AES_192, iv2, sizeof(iv2), ciphertext5, sizeof(ciphertext5), plain2_cbc, 32, NO_PAD, CBC);
    failed |= assert_eq_texts(plain2_cbc, plaintext5, sizeof(plaintext5), "AES-192-CBC decryption test 1");

    crypt_AES_encrypt(key_256_1, sizeof(key_256_1), AES_256, iv3, sizeof(iv3), NULL, 0, plaintext6, sizeof(plaintext6), cipher1_cbc, 32, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher1_cbc, ciphertext6, sizeof(ciphertext6), "AES-256-CBC encryption test 1");

    crypt_AES_decrypt(key_256_1, sizeof(key_256_1), AES_256, iv3, sizeof(iv3), ciphertext6, sizeof(ciphertext6), plain2_cbc, 32, NO_PAD, CBC);
    failed |= assert_eq_texts(plain2_cbc, plaintext6, sizeof(plaintext6), "AES-256-CBC decryption test 1");

    // using sizeof(plaintext_cbc2) - 1 to not encrypt the null character as the python script used to generate test data does not encrypt the null char
    crypt_AES_encrypt(key_256_cbc, sizeof(key_256_cbc), AES_256, iv_cbc2, sizeof(iv_cbc2), NULL, 0, plaintext_cbc2, sizeof(plaintext_cbc2) - 1, cipher4_cbc, 192, NO_PAD, CBC);
    failed |= assert_eq_texts(cipher4_cbc, ciphertext2_cbc, sizeof(ciphertext2_cbc), "AES-256-CBC encryption test 2");

    crypt_AES_decrypt(key_256_cbc, sizeof(key_256_cbc), AES_256, iv_cbc2, sizeof(iv_cbc2), ciphertext2_cbc, sizeof(ciphertext2_cbc), plain4_cbc, 192, NO_PAD, CBC);
    failed |= assert_eq_texts(plain4_cbc, plaintext_cbc2, sizeof(plaintext_cbc2) - 1, "AES-256-CBC decryption test 2");


    return failed;
}

int AES_CTR_test(){
    int failed = 0;

    uint8_t nonce1_128[8] = {0xF0, 0xF1, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7};
    uint8_t counter1_128[8] = {0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF};

    const uint8_t plaintext1[] = {
        0x6B, 0xC1, 0xBE, 0xE2, 0x2E, 0x40, 0x9F, 0x96, 
        0xE9, 0x3D, 0x7E, 0x11, 0x73, 0x93, 0x17, 0x2A, 
        0xAE, 0x2D, 0x8A, 0x57, 0x1E, 0x03, 0xAC, 0x9C, 
        0x9E, 0xB7, 0x6F, 0xAC, 0x45, 0xAF, 0x8E, 0x51, 
        0x30, 0xC8, 0x1C, 0x46, 0xA3, 0x5C, 0xE4, 0x11, 
        0xE5, 0xFB, 0xC1, 0x19, 0x1A, 0x0A, 0x52, 0xEF, 
        0xF6, 0x9F, 0x24, 0x45, 0xDF, 0x4F, 0x9B, 0x17, 
        0xAD, 0x2B, 0x41, 0x7B, 0xE6, 0x6C, 0x37, 0x10
    };

    const uint8_t key1_128[] = {
        0x2B, 0x7E, 0x15, 0x16, 0x28, 0xAE, 0xD2, 0xA6,
        0xAB, 0xF7, 0x15, 0x88, 0x09, 0xCF, 0x4F, 0x3C
    };

    const uint8_t ciphertext1[] = {
        0xF0, 0xF1, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7,
        0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF,
        0x87, 0x4D, 0x61, 0x91, 0xB6, 0x20, 0xE3, 0x26,
        0x1B, 0xEF, 0x68, 0x64, 0x99, 0x0D, 0xB6, 0xCE,
        0x98, 0x06, 0xF6, 0x6B, 0x79, 0x70, 0xFD, 0xFF,
        0x86, 0x17, 0x18, 0x7B, 0xB9, 0xFF, 0xFD, 0xFF,
        0x5A, 0xE4, 0xDF, 0x3E, 0xDB, 0xD5, 0xD3, 0x5E,
        0x5B, 0x4F, 0x09, 0x02, 0x0D, 0xB0, 0x3E, 0xAB,
        0x1E, 0x03, 0x1D, 0xDA, 0x2F, 0xBE, 0x03, 0xD1,
        0x79, 0x21, 0x70, 0xA0, 0xF3, 0x00, 0x9C, 0xEE
    };

    uint8_t cipher1[80];
    uint8_t plain1[64];

    crypt_AES_encrypt(key1_128, sizeof(key1_128), AES_128, nonce1_128, sizeof(uint64_t), counter1_128, sizeof(uint64_t), 
                        plaintext1, sizeof(plaintext1), cipher1, sizeof(cipher1), NO_PAD, CTR);
    failed |= assert_eq_texts(cipher1, ciphertext1, sizeof(ciphertext1), "AES-128-CTR encryption - test 1");

    crypt_AES_decrypt(key1_128, sizeof(key1_128), AES_128, NULL, 0, ciphertext1, sizeof(ciphertext1), plain1, sizeof(plain1), NO_PAD, CTR);
    failed |= assert_eq_texts(plain1, plaintext1, sizeof(plaintext1), "AES-128-CTR decryption - test 1");

///////// test 2 //////////
    const uint8_t key2_128[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };

    uint8_t counter2[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
    const uint8_t nonce2[] = {0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF};

    const uint8_t plaintext2[] = {
        "Now is the time for all good men to come to the aid of their country."
    };

    const uint8_t ciphertext2[] = {
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
        0x37, 0xB1, 0x8A, 0x39, 0x35, 0x7E, 0x20, 0xED, 
        0x52, 0x4F, 0x49, 0xFD, 0x0C, 0xDA, 0xA1, 0x1F, 
        0x3C, 0xC3, 0x86, 0xB1, 0x6A, 0x78, 0xC5, 0x21, 
        0xD1, 0x4E, 0xF8, 0xB8, 0xDC, 0xAE, 0xD6, 0x4A, 
        0x8C, 0x1F, 0xF2, 0x03, 0xE2, 0xF7, 0xB5, 0xAA, 
        0x94, 0x13, 0x7A, 0x4B, 0x0A, 0xBC, 0x66, 0xDD, 
        0xD3, 0xEA, 0x3A, 0x55, 0xDB, 0x6A, 0x04, 0x72, 
        0x8D, 0xA9, 0xA9, 0xCE, 0x0C, 0x4F, 0xB8, 0xC5, 
        0x3A, 0x51, 0xF2, 0x2A, 0xFD

    };

    uint8_t cipher2[85];
    uint8_t plain2[69]; // excluding null char

    crypt_AES_encrypt(key2_128, sizeof(key2_128), AES_128, nonce2, sizeof(uint64_t), counter2, sizeof(uint64_t), 
                        plaintext2, sizeof(plaintext2)-1, cipher2, sizeof(cipher2), NO_PAD, CTR);
    failed |= assert_eq_texts(cipher2, ciphertext2, sizeof(ciphertext2), "AES-128-CTR encryption - test 2");

    crypt_AES_decrypt(key2_128, sizeof(key2_128), AES_128, NULL, 0, ciphertext2, sizeof(ciphertext2), plain2, sizeof(plain2), NO_PAD, CTR);
    failed |= assert_eq_texts(plain2, plaintext2, sizeof(plaintext2)-1, "AES-128-CTR decryption - test 2");

    ///////// test 3 //////////
    const uint8_t nonce3[] = {0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF};
    uint8_t counter3[] = {0x91, 0xA7, 0x27, 0x61, 0xC7, 0x90, 0x0C, 0xEE};
    const uint8_t key3_128[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };

    const uint8_t plaintext3[] = {
        "The quick brown fox jumps over the lazy dog"
    };

    const uint8_t ciphertext3[] = {
        0x0A, 0x12, 0x3D, 0x56, 0x01, 0x11, 0xAE, 0xFF,
        0x91, 0xA7, 0x27, 0x61, 0xC7, 0x90, 0x0C, 0xEE,
        0xA7, 0x8D, 0xA7, 0x04, 0x51, 0x72, 0x85, 0xD3, 
        0xC6, 0x38, 0xB6, 0x4B, 0x09, 0x39, 0xC2, 0xA7, 
        0x68, 0x35, 0xB3, 0x14, 0x47, 0x38, 0x33, 0x4A, 
        0xC0, 0xCF, 0xC5, 0xE3, 0xB8, 0xF3, 0x00, 0xA4, 
        0x4D, 0xB7, 0xC8, 0x41, 0x50, 0xBA, 0x36, 0x21, 
        0x9E, 0xBB, 0x5A
    };

    uint8_t cipher3[43 + 16];
    uint8_t plain3[43];

    crypt_AES_encrypt(key3_128, sizeof(key3_128), AES_128, nonce3, sizeof(uint64_t), counter3, sizeof(uint64_t), 
                        plaintext3, sizeof(plaintext3)-1, cipher3, sizeof(cipher3), NO_PAD, CTR);
    failed |= assert_eq_texts(cipher3, ciphertext3, sizeof(ciphertext3), "AES-128-CTR encryption - test 3");

    crypt_AES_decrypt(key3_128, sizeof(key3_128), AES_128, NULL, 0, ciphertext3, sizeof(ciphertext3), plain3, sizeof(plain3), NO_PAD, CTR);
    failed |= assert_eq_texts(plain3, plaintext3, sizeof(plaintext3)-1, "AES-128-CTR decryption - test 3");

    ///////// test 4 - AES_192 //////////
    const uint8_t key_192[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70
    };
    const uint8_t nonce4[] = {0x12, 0x34, 0x56, 0x78, 0x90, 0xAB, 0xCD, 0xEF};
    uint8_t counter4[] = {0xCB, 0x6E, 0x5A, 0x2E, 0x27, 0x79, 0x28, 0x8D};

    const uint8_t plaintext4[] = {
        "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
    };

    const uint8_t ciphertext4[] = {
        0x12, 0x34, 0x56, 0x78, 0x90, 0xAB, 0xCD, 0xEF,
        0xCB, 0x6E, 0x5A, 0x2E, 0x27, 0x79, 0x28, 0x8D,
        0x34, 0xE1, 0x9D, 0x8E, 0x07, 0x1A, 0x24, 0x67, 
        0xAA, 0xA2, 0x85, 0x1F, 0x6F, 0xCB, 0xD7, 0x4A, 
        0x59, 0x4A, 0xB9, 0x68, 0x0E, 0xA5, 0x1B, 0xC2, 
        0x99, 0x71, 0xAE, 0xF3, 0x7F, 0x74, 0x97, 0xBE, 
        0x60, 0x84, 0xE7, 0x6C, 0x31, 0xB4, 0x0C, 0x0D, 
        0xB5, 0x7B, 0x6C, 0x34, 0x00, 0xAC, 0x7E, 0x87, 
        0x1A, 0xE6, 0x67, 0x69, 0xDC, 0xA5, 0x35, 0xDC, 
        0x10, 0xE2, 0xB4, 0x2C, 0xB5, 0xB2, 0xD8, 0x03, 
        0xC5, 0xCB, 0x1C, 0xDF, 0x22, 0x79, 0x63, 0x71, 
        0x91, 0x89, 0xA3, 0x06, 0xE2, 0xF6, 0xC4, 0x86, 
        0x46, 0xFB, 0xBE, 0x64, 0x83, 0x16, 0xF4, 0xCE, 
        0x4E, 0x89, 0x8D, 0x3A, 0xF2, 0x28, 0xCF, 0x92, 
        0xD8, 0xD5, 0xCE, 0xCA, 0xE5, 0x75, 0xEF, 0x64, 
        0xC4, 0x08, 0xFB, 0x2A, 0xA8, 0xDF, 0xBB, 0xF1, 
        0xD9, 0xB8, 0xCD, 0x96, 0x60, 0xA3, 0xD0, 0x56, 
        0xB1, 0x4D, 0xAE
    };

    uint8_t cipher4[123 + 16];
    uint8_t plain4[123];

    crypt_AES_encrypt(key_192, sizeof(key_192), AES_192, nonce4, sizeof(uint64_t), counter4, sizeof(uint64_t), 
                        plaintext4, sizeof(plaintext4)-1, cipher4, sizeof(cipher4), NO_PAD, CTR);
    failed |= assert_eq_texts(cipher4, ciphertext4, sizeof(ciphertext4), "AES-192-CTR encryption - test 4");

    crypt_AES_decrypt(key_192, sizeof(key_192), AES_192, NULL, 0, ciphertext4, sizeof(ciphertext4), plain4, sizeof(plain4), NO_PAD, CTR);
    failed |= assert_eq_texts(plain4, plaintext4, sizeof(plaintext4)-1, "AES-192-CTR decryption - test 4");


    // crypt_AES_decrypt(key_192, sizeof(key_192), AES_192, nonce)

    ///////// test 5 - AES_256 //////////
    const uint8_t key_256[] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0x75, 0x28, 0x78, 0x39, 0x74, 0x93, 0xCB, 0x70,
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF
    };
    const uint8_t nonce5[] = {0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 0x01};
    uint8_t counter5[] = {0xF2, 0xD9, 0xBF, 0xF4, 0x5A, 0x55, 0xCA, 0xCF};

    const uint8_t plaintext5[] = {
        "Sample message for encryption"
    };

    const uint8_t ciphertext5[] = {
        0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 0x01,
        0xF2, 0xD9, 0xBF, 0xF4, 0x5A, 0x55, 0xCA, 0xCF,
        0x01, 0xEC, 0x67, 0x12, 0x6D, 0xAF, 0xE1, 0x52, 
        0xC0, 0xAB, 0x05, 0x94, 0x33, 0x73, 0xCA, 0x3E, 
        0x98, 0x6A, 0x55, 0xC9, 0x0E, 0xF9, 0x7F, 0x29, 
        0xE3, 0x60, 0xD0, 0xD0, 0xD9
    };

    uint8_t cipher5[29 + 16];
    uint8_t plain5[29];

    crypt_AES_encrypt(key_256, sizeof(key_256), AES_256, nonce5, sizeof(uint64_t), counter5, sizeof(uint64_t), 
                        plaintext5, sizeof(plaintext5)-1, cipher5, sizeof(cipher5), NO_PAD, CTR);
    failed |= assert_eq_texts(cipher5, ciphertext5, sizeof(ciphertext5), "AES-256-CTR encryption - test 5");
    
    crypt_AES_decrypt(key_256, sizeof(key_256), AES_256, NULL, 0, ciphertext5, sizeof(ciphertext5), plain5, sizeof(plain5), NO_PAD, CTR);
    failed |= assert_eq_texts(plain5, plaintext5, sizeof(plaintext5)-1, "AES-256-CTR decryption - test 5");
    return failed;
}