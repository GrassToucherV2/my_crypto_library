#include "../lib/md5.h"
#include "test_util.h"
#include <stdio.h>

int md5_sanity_test(){
    int failed = 0;

    print_msg(YELLOW, "MD5 PADDING SUBTEST");

    unsigned char msg1[] = {
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06
    };

    unsigned char exp_output1[] = {
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x80, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    };

    unsigned char output[64] = {};

    md5_pad(msg1, sizeof(msg1), output, sizeof(output));

    if(memcmp(exp_output1, output, sizeof(exp_output1))){
        failed = 1;
        print_failed("md5_pad 1 test failed");
        print_bytes(exp_output1, sizeof(exp_output1), "r = ");
        print_bytes(output, sizeof(output), "o = ");
    } else{
        print_passed("md5_pad 1 test passed");
        print_bytes(output, sizeof(output), "o = ");
    }

    unsigned char msg2[] = {
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x80, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };

    // my laptop is little endian, so 0x02, 0x00 becomes 0x00, 0x02
    unsigned char exp_output2[] = {
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x80, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };

    unsigned char output2[128] = {};
    md5_pad(msg2, sizeof(msg2), output2, sizeof(output2));

    if(memcmp(exp_output2, output2, sizeof(exp_output2))){
        failed = 1;
        print_failed("md5_pad 2 test failed");
        print_bytes(exp_output2, sizeof(exp_output2), "r = ");
        print_bytes(output2, sizeof(output2), "o = ");
    } else{
        print_passed("md5_pad 2 test passed");
        print_bytes(output2, sizeof(output2), "o = ");
    }



    return failed;
}
